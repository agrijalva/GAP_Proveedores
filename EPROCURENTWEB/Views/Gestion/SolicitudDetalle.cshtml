
@{
    ViewBag.Title = "Solicitud Detalle";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">

<link href="~/Content/Styles/Site.css" rel="stylesheet" />
<link href="~/Content/bootstrap.css" rel="stylesheet" />
<link href="~/Content/Css/infoCuenta.css" rel="stylesheet" />
<link href="~/Content/validacionProveedor.css" rel="stylesheet" />

<div class="row">
    <div class="col-md-12">
        <h5 class="mt-2 detalle-titulo">Solicitud de Facturación</h5>
        <div class="card mt-3">
            <div class="card-header mb-2" id="headingOne">
                <span class="card-titulo">
                    Orden: SIAP-OC-0003565
                </span>
            </div>
            @Html.Hidden("idSolicitudFactura", (int)ViewBag.IdSolicitudFactura)
            <div class="card-body no-border">
                <div class="row">
                    <div class="col-sm-3 cabecero-detalle">
                        <label>Descripción</label>
                        <p class="control-label">
                            @Html.Label("lblDescripcion", "lblDescripcion", new { id = "lblDescripcion" })
                        </p>
                        
                    </div>

                    <div class="col-sm-2 cabecero-detalle">
                        <label>Importe contratado sin I.V.A.</label>
                        <p class="control-label">
                            @Html.Label("lblImporteContratado", "lblImporteContratado", new { id = "lblImporteContratado", @class = "" })
                        </p>
                    </div>

                    <div class="col-sm-2 cabecero-detalle">
                        <label>Importe facturado sin I.V.A.</label>
                        <p class="control-label">@Html.Label("lblImporteFacturado", "lblImporteFacturado", new { id = "lblImporteFacturado" })</p>
                    </div>

                    <div class="col-sm-3 cabecero-detalle">
                        <label>Importe pendiente de facturar sin I.V.A.</label>
                        <p class="control-label">@Html.Label("lblImportePendiente", "lblImportePendiente", new { id = "lblImportePendiente" })</p>
                    </div>

                    <div class="col-sm-2 cabecero-detalle">
                        <label>Importe pagado sin I.V.A.</label>
                        <p class="control-label">@Html.Label("lblImporteFacturar", "lblImporteFacturar", new { id = "lblImporteFacturar" })</p>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-3">
    <div class="col-sm-12">
        <button class="btn-white">Exportar Excel</button>
    </div>
</div>


<div class="row mt-3">
    <div class="col-sm-12">
        <table id="Table" class="table-detalle dataTable dataTables_wrapper ">
        </table>
    </div>
</div>

<div class="row mt-3">
    <div class="col-sm-6">&nbsp;</div>
    <div class="col-sm-3">
        <button class="btn-white">Adjuntar XML</button>
    </div>
    <div class="col-sm-3">
        <button class="btn-white">Adjuntar PDF</button>
    </div>
</div>

<script type="text/javascript">
        var fn_buscar = function () {
        var numeroSolicitud = $('#idSolicitudFactura').val() == '' ? null : $('#idSolicitudFactura').val();
            console.log('idSolicitudFactura', numeroSolicitud);
            var jsonData = JSON.stringify({ idSolicitudFactura: numeroSolicitud });
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("GetSolicitudDetalleList", "Gestion")',
                    data: jsonData,
                    async: false,
                    success: function (data) {
                        var importePendiente = (data.SolicitudFacturaCabecera.ImporteContratado - data.SolicitudFacturaCabecera.ImporteFacturado + data.SolicitudFacturaCabecera.ImporteFacturar)
                        console.log(data.SolicitudFacturaCabecera.Descripcion);
                        $('#lblDescripcion').html(data.SolicitudFacturaCabecera.Descripcion);
                        $('#lblImporteContratado').html(data.SolicitudFacturaCabecera.ImporteContratado);
                        $('#lblImporteFacturado').html(data.SolicitudFacturaCabecera.ImporteFacturado);
                        $('#lblImportePendiente').html(importePendiente);
                        $('#lblImporteFacturar').html(data.SolicitudFacturaCabecera.ImporteFacturar);

                        $("#Table").html('');
                        $("#Table").append('<thead class="bg-light-purple"><tr>' +
                            '<td width="80">ID Lineas</td>'+
                            '<td width="80">Descripción</td>' +
                            '<td>Cantidad Adquirida</td>' +
                            '<td>Precio Unitario</td>' +
                            '<td>Importe Adquirido</td>' +
                            '<td>Cantidad Facturada</td>' +
                            '<td>Cantidad a Facturar</td>' +
                            '<td>Importe Facturado <br />sin I.V.A.</td>' +
                            '<td>Importe a Facturar <br />sin I.V.A.</td></tr></thead>'
                        );
                        $("#Table").DataTable().clear().draw();
                        $("#Table").DataTable().destroy();
                        $("#Table").append('<tbody>');
                        console.log( "SolicitudFacturaDetalleList", data.SolicitudFacturaDetalleList );
                        for (i = 0; i < data.SolicitudFacturaDetalleList.length; i++) {                           
                            $("#Table").append('<tr>' +
                                '<td style="dislay: none;"><b>' + data.SolicitudFacturaDetalleList[i].Linea + '</b></td>' +
                                '<td style="dislay: none;">' + data.SolicitudFacturaDetalleList[i].Descripcion + '</td>' +
                                '<td style="dislay: none;">' + data.SolicitudFacturaDetalleList[i].CantidadAdquirida + '</td>' +
                                '<td style="dislay: none;">' + data.SolicitudFacturaDetalleList[i].PrecioUnitario + '</td>' +
                                '<td style="dislay: none;">' + data.SolicitudFacturaDetalleList[i].ImporteAdquirido + '</td>' +
                                '<td style="dislay: none;">' + data.SolicitudFacturaDetalleList[i].CantidadFacturada + '</td>' +
                                '<td style="dislay: none;">' + data.SolicitudFacturaDetalleList[i].CantidadFacturar + '</td>' +
                                '<td style="dislay: none;">' + data.SolicitudFacturaDetalleList[i].ImporteFacturado + '</td>' +
                                '<td style="dislay: none;">' + data.SolicitudFacturaDetalleList[i].ImporteFacturar + '</td>' + '</tr>'
                            );
                        }
                        $("#Table").append('</tbody>');

                        $('#Table').DataTable({
                            "paging": false,
                                "bScrollInfinite": true,
                                "bScrollCollapse": true
                            });

                    },
                });
        }

        $(document).ready(function () {
            fn_buscar();
            $(".navbar-nav .nav-item").removeClass("active");
            $("#nav-2").addClass("active");
        });

    </script>
